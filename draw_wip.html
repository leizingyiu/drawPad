<!-- 
    Last modified: "2021/10/20 13:23:04"
 -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <title>drawPad_by_leizingyiu</title>
    <style>
        body {
            overflow: hidden;
        }

        div#panel {
            position: absolute;
            left: 1em;
            bottom: 1em;
            font-size: 8px;
            opacity: 0.6;
        }

        p#info,
        form#blendModes {
            user-select: none;
        }

        form#blendModes {
            display: flex;
            flex-wrap: wrap;
        }
    </style>
</head>

<body style="margin:0">
    <div id="panel">
        <p id="info"></p>
        <form id='blendModes'>blend mode</form>
    </div>
    <main></main>

    <script>
        // cookies
        var cookie = document.cookie;
        console.log(cookie);


    </script>
    <script src="https://cdn.bootcdn.net/ajax/libs/p5.js/1.4.0/p5.min.js"></script>
    <script>
        /*page setting*/
        // 禁止右键菜单
        document.oncontextmenu = function (event) {
            event.preventDefault()
        };

        // 禁止橡皮筋效果
        document.body.addEventListener('touchmove', function (e) {
            e.preventDefault();
        }, { passive: false });

        var startY, endY;
        //记录手指触摸的起点坐标
        document.querySelector('body').addEventListener('touchstart', function (e) {
            startY = e.touches[0].pageY;
        });
        document.querySelector('body').addEventListener('touchmove', function (e) {
            endY = e.touches[0].pageY;  //记录手指触摸的移动中的坐标
            //手指下滑，页面到达顶端不能继续下滑
            if (endY > startY && window.scrollTop() <= 0) {
                e.preventDefault();
            }
            //手指上滑，页面到达底部能继续上滑
            if (endY < startY && window.scrollY +
                window.innerHeight >= document.querySelector.scrollHeight) {
                e.preventDefault();
            }
        });



        //禁用页面前进后退
        history.pushState(null, null, document.URL);
        window.addEventListener('popstate', function () {
            history.pushState(null, null, document.URL);
        });


    </script>
    <script>
        /*page loading*/
        var blendModes = {
            ADD: "ADD",
            BLEND: "BLEND",
            BURN: "BURN",
            DARKEST: "DARKEST",
            DIFFERENCE: "DIFFERENCE",
            DODGE: "DODGE",
            EXCLUSION: "EXCLUSION",
            HARD_LIGHT: "HARD_LIGHT",
            LIGHTEST: "LIGHTEST",
            MULTIPLY: "MULTIPLY",
            OVERLAY: "OVERLAY",
            REPLACE: "REPLACE",
            SCREEN: "SCREEN",
            SOFT_LIGHT: "SOFT_LIGHT"
        }
        blendModesForm = document.querySelector('#blendModes');
        Object.entries(blendModes).map(i => {
            let l = document.createElement('lable');
            let input = document.createElement('input');
            l.setAttribute('for', 'blendModes_' + i[0]);
            l.innerHTML = '<input type="radio" name="blendMode" id="blendModes_' + i[0] + '"" value="' + i[0] + '" >' + i[1];
            blendModesForm.appendChild(l);
        })

        blendModesForm.addEventListener('input', function inputHandler(e) {
            console.log(e.target.value);
            cblend = e.target.value;
        });



        var cV = 196;
        var c1 = [255, 255, 255],
            c2 = [cV, cV, cV],
            brushWeight = 1,
            cblend = "NORMAL";
        var beforeX, beforeY;
        var pressCtrl = false;

        function setup() {
            c = createCanvas(windowWidth, windowHeight);
            background(...c1);
            writeP();
        }

        function draw() {

            backstage();

            drawing();

        }

        function backstage(params) {
            if (keyIsDown(219)) {
                strokeWeightChanging(-1);
            }
            if (keyIsDown(221)) {
                strokeWeightChanging(1);
            }
            if (keyIsDown(187)) {
                cV--;
                cV = cV <= 0 ? 0 : cV;
                c2 = [cV, cV, cV];
                strokeWeightChanging(0)
            }
            if (keyIsDown(189)) {
                cV++;
                cV = cV > 254 ? 254 : cV;
                c2 = [cV, cV, cV];
                strokeWeightChanging(0)
            }
        }

        function drawing() {

            strokeWeight(brushWeight);

            if (mouseIsPressed) {
                if (mouseButton === LEFT) {
                    stroke(...c2);
                    blendMode(eval(cblend))
                }
                if (mouseButton === RIGHT || mouseButton === CENTER) {
                    stroke(...c1);
                    blendMode(LIGHTEST)
                }
                if (typeof beforeX != 'undefined') {
                    line(beforeX, beforeY, mouseX, mouseY)
                }
                beforeX = mouseX;
                beforeY = mouseY;

            } else {
                beforeX = undefined;
                beforeY = undefined;
            }
        }

        function mouseWheel(event) {
            strokeWeightChanging(-event.delta / 10);
        }

        function writeP() {
            document.querySelector('p').innerHTML = '当前笔刷大小为 ' + brushWeight + ' , 当前颜色为 ' + cV + '</br> 鼠标滚轮 以及 中括号键 [ ] 可以调节笔刷大小；</br> 鼠标左键为画笔，右键为擦除；</br> 按 ctrl + enter 可以保存当前画面，按 esc 可清理画布';
        }

        function strokeWeightChanging(change) {
            var max = 100;
            var min = 1;
            blendMode(NORMAL);
            strokeWeight(0);
            fill(...c1);
            rect(windowWidth - max * 1, windowHeight - max * 1, max, max);
            brushWeight += change;
            console.log(brushWeight);
            brushWeight = brushWeight < min ? min : brushWeight;
            brushWeight = brushWeight > max ? max : brushWeight;
            blendMode(NORMAL);
            fill(...c2);
            circle(windowWidth - max * 0.5, windowHeight - max * 0.5, brushWeight);
            writeP();
        }

        function keyPressed() {
            console.log(keyCode);
            if (keyCode === ESCAPE) {
                fill(c1);
                rect(0, 0, windowWidth, windowHeight);
            }
            if (keyCode === 17) {
                pressCtrl = true;
            }
            if (keyCode === 13 && pressCtrl) {
                saveCanvas(c, 'myCanvas', 'jpg');
            }
            writeP();
        }

        function keyReleased() {
            if (keyCode === 17) {
                pressCtrl = false;
            }
        }
    </script>
</body>

</html>